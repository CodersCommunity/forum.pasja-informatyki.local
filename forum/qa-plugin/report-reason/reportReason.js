!function(e){var o={};function t(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=e,t.c=o,t.d=function(e,o,r){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var n in e)t.d(r,n,function(o){return e[o]}.bind(null,n));return r},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=0)}([function(e,o,t){"use strict";t.r(o);var r=(e,o,t,r,n)=>{new Promise((t,r)=>{fetch(e,{method:"POST",body:o}).then(t,r),setTimeout(()=>{r("Ajax timeout")},n)}).then(t,r)};const n=[{value:"spam",description:"SPAM"},{value:"insult",description:"Wypowiedź jest obraźliwa"},{value:"incorrectDescription",description:"Nieprawidłowy temat/kategoria/otagowanie"},{value:"misunderstoodContent",description:"Niepełna lub niezrozumiała treść"},{value:"duplicate",description:"Duplikat pytania"},{value:"codeNotInBlock",description:"Kod nie jest umieszczony w odpowiednim bloczku"},{value:"custom",description:"Inny (dodaj opis)"}].reduce((e,o,t,r)=>{const n=`reportReasonItem${t}`,a=t===r.length-1,s=a&&'<textarea id="customReportReason" rows="3" cols="47" name="reportReason" class="report-reason-popup__custom-report-reason" data-requirable="true"></textarea>';return e+`\n        <li>\n            <label for="${n}">\n                <input id="${n}" type="radio" value="${o.value}" name="reportReason" data-requirable="true">\n                ${o.description}\n            </label>\n            ${a?s:""}\n        </li>\n    `},""),a=function(){const e=document.createElement("div");return e.classList.add("report-reason-wrapper"),e.innerHTML=`\n        <link href="../qa-plugin/report-reason/reportReason.css" rel="stylesheet" type="text/css">\n         \n        <div id="reportReasonPopup" class="report-reason-popup">\n            <p>Zaznacz proszę powód zgłoszenia lub podaj własny:</p>\n            \n            <form method="post" class="report-reason-popup__form">\n                <ul id="reportReasonList" class="report-reason-popup__list">${n}</ul>\n            \n                <p id="reportReasonValidationError" class="report-reason-popup__validation-error">Nie zaznaczono powodu zgłoszenia!</p>\n                \n                <input id="cancelReportReason" type="button" value="Anuluj" class="report-reason-popup__button report-reason-popup__button--cancel">\n                <button id="sendReportReason" type="submit" class="report-reason-popup__button report-reason-popup__button--save">Wyślij</button>\n            </form>\n        </div>\n        <div id="reportReasonSuccessInfo" class="report-reason-popup__success-info">\n            Zgłoszenie zostało wysłane.\n            <button id="closeReportReasonSentInfo" class="report-reason-popup__button report-reason-popup__button--close" type="button">Zamknij</button>\n        </div>\n    `,e}(),s={reportReasonPopup:a.querySelector("#reportReasonPopup"),reportReasonPopupForm:a.querySelector("form"),customReportReason:a.querySelector("#customReportReason"),reportReasonSuccessInfo:a.querySelector("#reportReasonSuccessInfo"),requirableFormElements:a.querySelectorAll('[data-requirable="true"]'),reportReasonValidationError:a.querySelector("#reportReasonValidationError")};var p=a;const{reportReasonPopup:i,reportReasonPopupForm:u,customReportReason:c,reportReasonSuccessInfo:l,requirableFormElements:d,reportReasonValidationError:m}=s,f=5e3,_="doflag",b={regex:{question:/q_doflag/,answer:/^a(\d+)_doflag/,comment:/^c(\d+)_doflag/,doComment:/^a(\d+)_docomment/},getNumberFromInputName(e,o){return(this.regex[e].exec(o)||[])[1]},recognizeInputKindByName(e){return Object.entries(this.regex).find(([o,t])=>t.test(e))[0]},collectForumPostMetaData(e){const o=this.recognizeInputKindByName(e.name),t={rootId:e.form.getAttribute("action").split("/")[1]};if("answer"===o)t.answerId=this.getNumberFromInputName("answer",e.name);else if("comment"===o){const o=e.parentElement.querySelector('[name*="_docomment"]');t.answerId=this.getNumberFromInputName("doComment",o.name),t.commentId=this.getNumberFromInputName("comment",e.name)}return t}};let v=!1,w=null;const R=e=>{u.action=e,p.classList.add("report-reason-wrapper--show")},y=()=>{l.classList.remove("report-reason-popup__success-info--show"),p.classList.remove("report-reason-wrapper--show"),c.classList.remove("report-reason-popup__custom-report-reason--show"),i.classList.remove("report-reason-popup--hide"),m.classList.remove("report-reason-popup__validation-error--show"),u.reset()},g=()=>{if(v)throw"bootstrapReportReasonPopup should be called only once!";p.addEventListener("click",e=>{const o=!e.composedPath().some(e=>"reportReasonPopup"===e.id||"reportReasonSuccessInfo"===e.id);o&&y()}),function(){const e=p.querySelector("#reportReasonList");e.addEventListener("change",({target:o})=>{m.classList.remove("report-reason-popup__validation-error--show"),e.children[e.children.length-1].contains(o)?(c.classList.add("report-reason-popup__custom-report-reason--show"),setTimeout(c.focus.bind(c))):c.classList.remove("report-reason-popup__custom-report-reason--show")})}(),p.querySelector("#cancelReportReason").addEventListener("click",y),p.querySelector("#sendReportReason").addEventListener("click",h),p.querySelector("#closeReportReasonSentInfo").addEventListener("click",y),document.querySelector(".qa-body-wrapper").appendChild(p),v=!0};function h(e){e.preventDefault();const o=e.target;o.blur(),function(e){const o=[...d].some(e=>{const o="radio"===e.type&&"custom"!==e.value&&e.checked,t="textarea"===e.tagName.toLowerCase()&&e.value;return o||t});o||function(e){m.classList.add("report-reason-popup__validation-error--show"),e.classList.add("report-reason-popup__button--save--validation-blink"),setTimeout(()=>{e.classList.remove("report-reason-popup__button--save--validation-blink")},1e3)}(e);return o}(o)&&(I(o,!0),r(u.action,function(){const e=b.collectForumPostMetaData(w),o=new FormData(u),t=o.getAll("reportReason"),r=Number("custom"===t[0]);o.set("reportReason",t[r]),o.set("questionId",e.rootId),e.answerId&&o.set("answerId",e.answerId);e.commentId&&o.set("commentId",e.commentId);return o}(),()=>(function(e){I(e,!1),i.classList.add("report-reason-popup--hide"),l.classList.add("report-reason-popup","report-reason-popup__success-info--show")})(o),e=>(function(e,o){I(e,!1),console.warn("ajaxError:",o)})(o,e),f))}function I(e,o){o?(e.disabled=!0,window.qa_show_waiting_after(e,!0)):(window.qa_hide_waiting(e),e.disabled=!1)}g.handler=function(e){e.target.name&&e.target.name.includes(_)&&(e.preventDefault(),e.stopPropagation(),w=e.target,R(e.target.form.action))};var L=g;document.addEventListener("DOMContentLoaded",function(){L(),document.querySelector(".qa-main").addEventListener("click",L.handler,!0)})}]);